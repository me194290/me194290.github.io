<!DOCTYPE html>
<html lang="en">
<head>
    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900"
          rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@4.x/css/materialdesignicons.min.css"
          rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/vuetify@2.x/dist/vuetify.min.css"
          rel="stylesheet">
    <meta name="viewport"
          content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, minimal-ui">
    <meta charset="UTF-8">
    <title>Title</title>
    <script>
        const alphabet = "0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";

        function base62_encode(num) {
            if (num == 0) {
                return alphabet[0]
            }
            num = Number(num);
            var arr = [];
            var base = alphabet.length;
            while (num) {
                var rem = num % base
                num = parseInt(num / base)
                arr.push(alphabet[rem])
            }
            return arr.reverse().join('')
        }

        function mid_to_base62(mid) {
            mid = (mid + "").split("").reverse().join("");
            var size = Math.ceil(mid.length / 7);
            var result = [];
            for (var i = 0; i < size; i++) {
                var s = mid.slice(i * 7, (i + 1) * 7).split("").reverse().join("")
                s = base62_encode(parseInt(s))
                if ((i < size - 1) && s.length < 4) {
                    s = '0' * (4 - s.length) + s
                }
                result.push(s)
            }
            return result.reverse().join('')
        }


        const regexps = [
            new RegExp("https?://m.weibo.cn/(\\d+)/(\\d+)")
        ];

    </script>
</head>
<body>


<div id="app">

    <v-container fluid>
        <v-row>
            <v-col
                    cols="12"
                    sm="6"
            >
                <v-textarea
                        v-model="message"
                        hint="例子：https://m.weibo.cn/3725773862/4645165437815554"
                        auto-grow
                        outlined
                        rows="20"
                        row-height="15"
                ></v-textarea>
            </v-col>
            <v-col
                    cols="12"
                    sm="6"
            >
                <v-textarea
                        v-bind:value="convert"
                        disabled
                        filled
                        auto-grow
                        rows="20"
                        row-height="15"
                ></v-textarea>
            </v-col>

        </v-row>
    </v-container>
</div>

<script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>
<!--    <script src="https://cdn.jsdelivr.net/npm/vue@2"></script>-->
<script src="https://cdn.jsdelivr.net/npm/vuetify@2.5.6/dist/vuetify.js"></script>
<script>
    var app = new Vue({
        el: '#app',
        vuetify: new Vuetify(),
        data: {
            message: ''
        },
        computed: {
            convert: function () {
                if (!this.message) {
                    return;
                }
                var result = [];
                for (let line of this.message.split("\n")) {
                    var matched = false;
                    for (let regexp of regexps) {
                        if ((regexp.test(line))) {
                            var groups = line.match(regexp);
                            var uid = groups[1];
                            var mid = groups[2];
                            result.push("https://weibo.com/" + uid + "/" + mid_to_base62(mid));
                            matched = true;
                            break
                        }
                    }
                    if (!matched) {
                        result.push("[转换失败]格式不支持");
                    }

                }
                return result.join('\n');
            }
        }
    })
</script>
</body>
</html>